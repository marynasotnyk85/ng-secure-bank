<mat-toolbar color="primary" class="toolbar">
  <span class="toolbar-title">Secure Bank</span>

  <span class="flex-spacer"></span>

  <button mat-button>
    <mat-icon>logout</mat-icon>
    Logout
  </button>
</mat-toolbar>


<div class="dashboard-wrapper">
  <div class="header-row">
    <div>
      <h2>Your accounts</h2>
      <p class="subtitle">Overview of your balances</p>
    </div>

    <button
      mat-raised-button
      color="accent"
      [routerLink]="['/bank/transfer']"
    >
      <mat-icon>send</mat-icon>
      Make a transfer
    </button>
  </div>

    <!-- Security banner -->
  <app-security-banner
    class="security-section"
    [title]="'Online banking security'"
    [messages]="securityMessages"
  ></app-security-banner>

  <!-- Loading state -->
  <div class="center" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
  </div>

  <!-- Error state -->
  <div class="center error" *ngIf="!isLoading && error">
    {{ error }}
    <button mat-stroked-button color="primary" (click)="loadAccounts()">
      Retry
    </button>
  </div>

  <!-- Accounts grid -->
  <div class="accounts-grid" *ngIf="!isLoading && !error">
    <mat-card class="account-card" *ngFor="let acc of accounts">
      <mat-card-header>
        <div mat-card-avatar class="account-avatar">
          <mat-icon>account_balance</mat-icon>
        </div>
        <mat-card-title>{{ acc.name }}</mat-card-title>
        <mat-card-subtitle>ID: {{ acc.id }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="balance-row">
          <span class="balance-label">Balance</span>
          <span class="balance-value">
            {{ acc.balance | number:'1.2-2' }} {{ acc.currency }}
          </span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Recent transactions table -->
  <mat-card class="transactions-card">
    <mat-card-title>Recent transactions</mat-card-title>
    <mat-card-subtitle>Last movements on your accounts</mat-card-subtitle>

    <div class="table-wrapper" *ngIf="dataSource.data.length; else noTx">
      <table mat-table [dataSource]="dataSource" matSort>

        <!-- Date -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
          <td mat-cell *matCellDef="let tx">
            {{ tx.date | date:'short' }}
          </td>
        </ng-container>

        <!-- From account -->
        <ng-container matColumnDef="from">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>From</th>
          <td mat-cell *matCellDef="let tx">
            {{ tx.fromAccountId }}
          </td>
        </ng-container>

        <!-- To IBAN -->
        <ng-container matColumnDef="to">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>To IBAN</th>
          <td mat-cell *matCellDef="let tx">
            <span matTooltip="{{ tx.toIban }}">
              {{ tx.toIban | slice:0:12 }}…
            </span>
          </td>
        </ng-container>

        <!-- Amount -->
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Amount</th>
          <td mat-cell *matCellDef="let tx">
            <span
              [ngClass]="{
                'amount-positive': tx.amount > 0,
                'amount-negative': tx.amount < 0
              }"
            >
              {{ tx.amount | number:'1.2-2' }} {{ tx.currency }}
            </span>
          </td>
        </ng-container>

        <!-- Description -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let tx">
            {{ tx.description || '—' }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <mat-paginator
        [length]="dataSource.data.length"
        [pageSize]="5"
        [pageSizeOptions]="[5, 10, 20]"
        showFirstLastButtons>
      </mat-paginator>
    </div>

    <ng-template #noTx>
      <p class="no-tx">No transactions found yet.</p>
    </ng-template>
  </mat-card>
</div>